const requestURL="https://krapipl.imumk.ru:8443/api/mobilev1/update",courseList=document.querySelector(".js-section-courses"),switchPaymentMethod=document.querySelector(".js-payment-switch"),selections=document.querySelector(".js-selections");function sendRequest(e,s,t){return fetch(s,{method:e,body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then(e=>e.ok?e.json():e.json().then(e=>{const s=new Error("Что-то пошло не так");throw s.data=e,s}))}const requestBody={data:""},courseItemDOMElement=(e,s=null)=>`\n    <li class="section-courses__item js-course-item">\n        <article class="section-courses__article">\n            <figure class="section-courses__figure">\n                <img src="https://www.imumk.ru/svc/coursecover/${e.courseId}" alt="обложка курса" class="section-courses__img">\n                <figcaption class="section-courses__figcaption">\n                    <div class="section-courses__about js-about-courses">\n                        <h3 class="section-courses__title">${e.subject}</h3>\n                        <p class="section-courses__grade js-courses-grade-text">${renderStages(e.grade)??e.grade} класс</p>\n                        <p class="section-courses__genre js-courses-genre-text">${e.genre}</p>\n                    </div>\n                    <div class="section-courses__more">\n                        <a href="${e.shopUrl}" class="section-courses__more-link" target="_blank">Подробнее</a>\n                    </div>\n                    ${""!==e.status?`<a href="#" class="section-courses__price-btn js-method-payment">\n                        <span>${s}</span>\n                        <span>&ensp;руб.</span>\n                    </a>`:'<span style="font-size:21px;">&nbsp;</span>'}\n                </figcaption>\n            </figure>\n        </article>\n    </li>\n`,showMessageIfEmptyList=()=>{const e=document.querySelector(".js-empty-courses");courseList.children.length||(e.classList.add("show"),switchPaymentMethod.classList.add("hidden")),0!==courseList.children.length&&(e.classList.remove("show"),switchPaymentMethod.classList.remove("hidden"))},removeAllItems=()=>{document.querySelectorAll(".js-course-item").forEach(e=>e.remove())},clearFields=e=>{for(let s of selections.children)e.value!==s.value&&(s.value="")};sendRequest("POST",requestURL,requestBody).then(e=>{selections.onchange=e=>{const t=e.target;for(let e of selections.children)""===e.value&&s();const n=selections.children[0],o=selections.children[1],r=selections.children[2];if(n.value&&n===t){clearFields(t),s();const e=document.querySelectorAll(".js-section-courses li h3");return c(e,t)}if(o.value&&o===t){clearFields(t),s();const e=document.querySelectorAll(".js-section-courses li .js-courses-genre-text");c(e,t)}if(r.value&&r===t){clearFields(t),s();const e=document.querySelectorAll(".js-section-courses li .js-courses-grade-text");return c(e,t)}};const s=()=>{let e=0;if(t.length!==courseList.children.length){for(let s=0;s<selections.children.length;s++)selections.children[s].value&&e++;e>1||(document.querySelectorAll(".js-course-item").forEach(e=>e.remove()),renderHTMLToDOM(t))}},t=e.items,n=document.querySelector(".js-switch-rub"),o=document.querySelector(".js-switch-bonus");toggleColorButton(n,o),courseList.children.length||renderHTMLToDOM(t);const c=(e,s)=>{for(let n of e){if(""!==s.value)s.value!==n.innerText&&parseInt(n.innerText)!==+s.value&&n.closest(".js-course-item").remove();else{if(courseList.children.length)break;renderHTMLToDOM(t)}showMessageIfEmptyList()}}}).catch(e=>console.log(e));const renderHTMLToDOM=e=>{const s=document.querySelector(".js-switch-rub"),t=document.querySelector(".js-switch-bonus");for(let n of e){const e=courseItemDOMElement(n,n.price);courseList.innerHTML+=e,switchPaymentMethod.addEventListener("click",e=>{const o=e.target.dataset.pay;"rub"===o&&(toggleColorButton(s,t),addNewPayment(o,n.price)),"bonus"===o&&(toggleColorButton(t,s),addNewPayment(o,n.priceBonus))})}},renderStages=e=>{const s=e.split(";");if(!(s.length<2))return s[0]+"-"+s[s.length-1]},addNewPayment=(e,s)=>{const t=document.querySelectorAll(".js-method-payment");for(let n of t)n.innerHTML=`\n            <span>${s}</span>\n            ${"rub"===e?"<span>&ensp;руб.</span>":"<span>&ensp;бонусов</span>"}\n        `},toggleColorButton=(e,s)=>{e.classList.add("active"),s.classList.remove("active")};